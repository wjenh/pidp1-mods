
      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 1


    1                   SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION
    2                   
    3                   / This uses the IOT 61 Drum implementation to query for, load,
    4                   / and run a program from the drum.
    5                   / It can also label a program, or list available programs.
    6                   / When started, it copies its control code to bank 'bank', below,
    7                   / When a program is requested, it copies the core image from the drum to bank 0 and
    8                   / replaces the default binloader at 7751 with its bank 0 control code, 
    9                   / It then sets up interrupt block 0, enables interrupts, closes the remote connection,
   10                   / and transfers control to the program.
   11                   / When a new connection comes in, it repeats the query for a new program to run.
   12                   / If the loaded program halts or overwrites 7751 and up,
   13                   / you can restart this at location 100 in the specified bank.
   14                   / It also uses IOT 22, DCS2, and IOT 32, timesharing clock.
   15                   
   16                   / The few implemented PDP1-D instructions
   17                   / Bit positions
   18       000020      liab=20
   19       000040      laib=40
   20       000060      lswb=60
   21       000060      swpb=60
   22       004000      cmib=4000
   23       004000      snib=4000
   24       014000      szib=14000
   25                   / Instruction form
   26       760020      lia=760000 liab
   27       760040      lai=760000 laib
   28       760060      lsw=760000 lswb
   29       760060      swp=760000 swpb
   30       764000      cmi=760000 cmib
   31       644000      sni=640000 snib
   32       654000      szi=640000 szib
   33                   
   34                   / This defines the IOT instructions for the Type 23 drum.
   35                   / Note this differs from the examples in that it does not add the iot
   36                   / explicitly, so use is e.g. iot dia.
   37       000061      dia=61
   38       002061      dba=2061
   39       000062      dwc=62
   40       002062      dra=2062
   41       000063      dcl=63
   42       002063      dss=2063
   43                   
   44                   / Additional flags, not compatible with native macro, only macro1.
   45                   / These flags are in the IO register.
   46       400000      drmrd=400000
   47       400000      drmwrt=400000
   48                   
   49                   / Bits for dss
   50       000040      drms16=40
   51       000020      drmsch=20
   52                   
   53                   / The bit set if a cks is done.
   54       000001      cksdrm=1
   55                   
   56                   / Defines for the DCS2 system.
   57                   / See the documentation.

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 2


   58                   / NOTE that rcr in DCS conflicts with rcr, rotate-combined-right.
   59                   / It is renamed rchr here.
   60       000022      rch=0022
   61       000122      rrc=0122
   62       001022      rchr=1022
   63       001122      rsc=1122
   64       004022      tcb=4022
   65       004122      ssb=4122
   66       005022      tcc=5022
   67                   
   68                   / rch and rcr will clear the IO register if
   69                   / this is added to the IOT, else it ors.
   70       002000      rchclr=002000
   71                   
   72                   / Extended commands.
   73       000222      rwe=0222
   74       004222      scb=4222
   75       004322      rle=4322
   76       004422      rpc=4422
   77       004522      rci=4522
   78       004622      ric=4622
   79       004722      rcs=4722
   80       005122      rwe=5122
   81       005222      roc=5222
   82       005322      res=5322
   83       005422      rxl=5422
   84                   
   85                   / symbols not compatible with native macro
   86                   / dcfxxx are single bit flags
   87                   / dcmxxx are multibit masks
   88                   / Channel Request Block first word
   89                   / dcfcrnl - turn newline into carriage return, newline on send
   90                   / dcfflex - flexo mode, do automatic conversion
   91                   / dcfecho - echo received characters
   92                   / dcfioc - interrupt on connection open or close
   93                   / dcfioe - interrupt on socket error
   94                   / dcfior - interroupt on character received
   95                   / dcfie -  enable interrupts for channel
   96                   / dcfsrv - server mode
   97                   / rxlfta - flexo to ascii
   98                   / rxlucs - flexo upper case shift
   99                   / rxlchg - flexo shift state changed
  100                   / dcmsbs - bitmask, sbs channel to use
  101                   / dcmcha - bitmask, channel number for this channel
  102                   
  103       400000      dcfcrnl=400000
  104       200000      dcfflex=200000
  105       100000      dcfecho=100000
  106       040000      dcfioc=040000
  107       020000      dcfioe=020000
  108       010000      dcfior=010000
  109       004000      dcfie=004000
  110       000100      dcfsrv=000100
  111       400000      rxlfta=0400000
  112       000400      rxlucs=00400
  113       001000      rxlchg=01000
  114                   

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 3


  115       003600      dcmsbs=003600
  116       000077      dcmcha=000077
  117                   
  118                   // Directives to scb
  119       010000      sbcset=010000
  120       020000      sbcbnd=020000
  121       040000      sbcrst=040000
  122       000000      sbcclr=000000
  123                   
  124                   / Channel status flags
  125                   / dsfopn - channel has been opened by scb
  126                   / dsfsvr - channel is a server channel, else client
  127                   / dsfcon - connected to remote host
  128                   / dsfful - socket transmit buffer is full
  129                   / dsfrdy - has characters ready to read
  130                   / dsfser - got a socket error of some kine
  131                   / dsfcls - remote closed connection
  132                   / dsfien - interrupts are enabled
  133                   / dsfior - interrupted because a character was received
  134                   / dsfioc - interrupted because a connection was opened or closed
  135                   / dsfioe - interrupted because transmit buffer full or other socket error
  136                   / dsfcur - is the current channel
  137                   
  138       000001      dsfopn=000001
  139       000002      dsfsvr=000002
  140       000004      dsfcon=000004
  141       000010      dsfful=000010
  142       000020      dsfrdy=000020
  143       000040      dsfser=000040
  144       000100      dsfcls=000100
  145       000200      dsfien=000200
  146       000400      dsfior=000400
  147       001000      dsfioc=001000
  148       002000      dsfioe=002000
  149       004000      dsfcur=004000
  150                   
  151                   / and some combined ones
  152       000005      dssrdy=dsfopn+dsfcon
  153       000150      dsserr=dsfcls+dsfser+dsfful
  154                   
  155                   / Errors returned in IO, dserr is the error flag
  156                   / dseno - channel not open
  157                   / dseoe - illegal operation on open channel
  158                   / dseic - invalid channel number
  159                   / dsens - server command on non-server channel
  160                   / dseil - illegal command, commdand with illegal options
  161                   / dseso - socket open or operation failed
  162                   / dsebi - server bind to port failed
  163                   / dsecc - rch, rcr, tcb, or tcc done but no current receive or send channel
  164                   / dselo - remote end closed connection
  165                   / dseep - internal error in epoll
  166                   / dsenc - no client connected but operation attempted
  167       400000      dserr=400000
  168       000001      dseno=1
  169       000002      dseoe=2
  170       000003      dseic=3
  171       000004      dsens=4

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 4


  172       000005      dseil=5
  173       000006      dseso=6
  174       000007      dsebi=7
  175       000010      dsecc=10
  176       000011      dselo=11
  177       000012      dseep=12
  178       000013      dsenc=13
  179                   
  180                   / check status bit in IO reg
  181       000200      dcfcks=000200
  182                   
  183                   / special flex characters
  184       000076      flxerr=076
  185       000013      flxnch=013
  186       000013      flxetx=013
  187       000077      flxnl=077
  188                   / ascnch is used by rxl
  189       000077      ascnch=077
  190                   
  191                   / Defines for the IOT_32 timesharing clock
  192                   / Use as iot rck, etc.
  193                   / rck - read 1ms clock
  194                   / cls - set clock parameters
  195                   / cct - set countdown timer
  196                   
  197       000032      rck=32
  198       002032      cls=2032
  199       002132      cct=2132
  200                   
  201                   / Flags in AC for cls, not compatible with macro, only macro1
  202                   / clss16 - enable SBS16, can't disable
  203                   / clsena - enable clock, must be set to use, including clr
  204                   / clsimn - enable minute interrupt
  205                   / clsims - enable 32ms interrupt
  206                   
  207       004000      cls16=4000
  208       002000      clsena=2000
  209       001000      clsimn=1000
  210       000400      clsims=400
  211                   
  212                   / And the channel masks
  213                   / clfmmn - minute channel
  214                   / clmffs - 32 millisecond channel
  215       000360      clfmmn=360
  216       000017      clfmms=17
  217                   
  218                   / NOTE for cct, enable SBS16 via iot cls cls16.
  219                   / Flags in AC for cct, not compatible with macro, only macro1
  220                   / cctie - enable interrupt
  221                   
  222       400000      cctie=400000
  223                   
  224                   / And the channel and timer masks
  225                   / cctich - interrupt channel
  226                   / cctcnt - countdown timer
  227       360000      cctmch=360000
  228       017777      cctcnt=017777

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 5


  229                   
  230                   / The cks flag for the countdown timer
  231       040000      cctcks=040000
  232                   
  233                   
  234                   / Which bank we load the control program into and its shifted value
  235       010000      bnk=10000
  236       000001      bnkno=1
  237       007751      isr=7751
  238       007754      rtn=7754
  239       007765      strt=7765
  240       007773      sadr=7773
  241                   
  242                   / A scratch buffer at 3000 is used for reading a line.
  243       003000      linbuf=3000
  244                   
  245                   / Put our included code bits here
  246 01000             1000/
  247                   / Wait for an ascii character on the current DCS channel.
  248                   / The IO register is cleared and the character is 
  249                   / returned in the IO register.
  250                   / If an error occurs, the IO register will be the rcs status with bit 0 set to 1.
  251                   / The AC register is preserved.
  252                   / Call via jda getach.
  253                   
  254                   
  255                   
  256                   
  257 01000 000000      getach, 0
  258 01001 261024           dap gachrt
  259                   / loop waiting for a character
  260                   gachlp,
  261 01002 764000           cli
  262 01003 724722           iot rcs
  263 01004 760040           lai
  264 01005 020642           and (dsfser dsfcls
  265 01006 640100           sza
  266 01007 601020           jmp gacher
  267 01010 760040           lai
  268 01011 020643           and (dsfrdy
  269 01012 650100           sza i
  270 01013 601002           jmp gachlp
  271 01014 722022           iot rch rchclr
  272 01015 642000           spi
  273 01016 601020           jmp gacher
  274 01017 601023           jmp gacdn
  275                   gacher,
  276 01020 760040           lai
  277 01021 040644           ior (400000
  278 01022 760020           lia
  279                   gacdn,
  280 01023 201000           lac getach
  281 01024 601024      gachrt, jmp .
  282                   
  283                   / Read a line of ascii characters into the memory address passed in the IO register.
  284                   / One character is placed in each word.
  285                   / The line is terminated by the null character, 0, and the line terminatior (nl or cr) dropped
      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 6


  286 01025 001025      .
  287                   / The memory area is not bounds checked!
  288                   / The current DCS2 channel is used.
  289                   / If an error occurs, the IO register will have the DCS2 rcs error code, else 0.
  290                   / The AC register is preserved.
  291                   / Call via jda getaln.
  292                   
  293                   
  294                   
  295                   
  296                   
  297 01026 000000      getaln, 0
  298 01027 261047              dap glartn
  299 01030 321050              dio glamem
  300 01031 171000      glalp,  jda getach
  301 01032 760040              lai
  302 01033 650100              sza i
  303 01034 601031              jmp glalp
  304 01035 640200              spa
  305 01036 601046              jmp glabad
  306 01037 331050              dio i glamem
  307 01040 500645              sad (15
  308 01041 601044              jmp gladon
  309 01042 441050              idx glamem
  310 01043 601031              jmp glalp
  311 01044 764000      gladon, cli
  312                   / overwrite the cr with 0
  313 01045 351050              dzm i glamem
  314 01046 201026      glabad, lac getaln
  315 01047 601047      glartn, jmp .
  316 01050 000000      glamem, 0
  317                   
  318                   / Write a block of ascii text out.
  319                   / Write out a string produced by ascii until a word containing
  320                   / only 0 is seen, the starting address is in the ac,
  321                   / ascii <whatever>
  322                   /
  323                   / Include this before using it or declaring text that uses
  324                   / the character defines, below.
  325                   /
  326                   / Output goes to SBS channel 0 which must be in ascii mode.
  327                   / On call, AC contains the address of the text block.
  328                   / Insert this at the desired point in code.
  329                   / Call via jda txtasc.
  330                   
  331                   
  332                   
  333                   
  334 01051 000000      txtasc, 0
  335 01052 241072           dac txartn
  336 01053 211051      txatop, lac i txtasc
  337                   / a word has xaaaaaaaaxbbbbbbbb
  338 01054 675017           sar 4s
  339 01055 675037           sar 5s
  340 01056 650100           sza i
  341 01057 611072           jmp i txartn
  342 01060 760020           lia

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 7


  343 01061 724022           iot tcb
  344 01062 700377           law 377
  345 01063 031051           and i txtasc
  346 01064 650100           sza i
  347 01065 611072           jmp i txartn
  348 01066 760020           lia
  349 01067 724022           iot tcb
  350 01070 441051           idx txtasc
  351 01071 601053           jmp txatop
  352 01072 000000      txartn, 0
  353                   
  354                   / Given a buffer of ascii digits, convert them to a binary number, return it in the AC.
  355                   / Base-10 is used.
  356                   / On call, the IO register contains the address of a buffer that contains one
  357                   / ascii character per word.
  358                   / Digits will be accumulated until a word of 0 is seen.
  359                   / If any character other than '0'-'9' is seen, processing stops
  360                   / and the number up to that point is returned.
  361                   / The IO register will have bit 0 set to 1 and the low 8 bits will have the character.
  362                   / The AC will have the number.
  363                   / No overflow condition is detected, high bits will shift out in this case.
  364                   / The maximum number is 98,304 unless AC is treated as unsigned, in which case it's 196,608.
  365 01073 000000      getnum, 0
  366 01074 241133           dac getnrt
  367 01075 341134           dzm getnbr
  368 01076 321135           dio getnbf
  369 01077 231135      getnlp, lio i getnbf
  370 01100 760040           lai
  371 01101 650100           sza i
  372 01102 601130           jmp getnok
  373 01103 420646           sub (60
  374 01104 640200           spa
  375 01105 601124           jmp getnbd
  376 01106 420647           sub (72-60
  377 01107 650200           spa i
  378 01110 601124           jmp getnbd
  379                   getndg,
  380                   / multiply current number by 10 using a 3-bit shift (times 8) and 2 adds
  381 01111 201134           lac getnbr
  382 01112 665007           sal 3s
  383 01113 401134           add getnbr
  384 01114 401134           add getnbr
  385 01115 241134           dac getnbr
  386 01116 760040           lai
  387 01117 420646           sub (60
  388 01120 401134           add getnbr
  389 01121 241134           dac getnbr
  390 01122 441135           idx getnbf
  391 01123 601077           jmp getnlp
  392 01124 760040      getnbd, lai
  393 01125 040644           ior (400000
  394 01126 760020           lia
  395 01127 601131           jmp .+2
  396 01130 764000      getnok, cli
  397 01131 201134           lac getnbr
  398 01132 611133           jmp i getnrt
  399 01133 000000      getnrt, 0

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 8


  400 01134 000000      getnbr, 0
  401 01135 000000      getnbf, 0
  402                   
  403                   
  404                   define say a
  405                       law a
  406                       ior (bnk
  407                       jda txtasc
  408                       term
  409                   
  410                   define newline
  411                       law 12
  412                       lia
  413                       iot tcb
  414                       term
  415                   
  416                   / DCS2 is using channel interrupts
  417 00000             0/
  418 00000 720074          lem
  419 00001 607765          jmp strt
  420 00002 000000          0
  421 00003 607751          jmp isr
  422                   
  423                   / We don't initially start here, just convenient for copying to the extended bank.
  424                   / The initial code will transfer here when done.
  425                   / When running, the bank 0 code will transfer here on interrupt, a channel connect.
  426 00100             100/
  427 00100 720054      resume, lsm
  428 00101 720056           cbs
  429 00102 764000           cli
  430 00103 724522           iot rci
  431                   / be sure we actually open and have a connection
  432                   / if not open, do so
  433                   / if open and not connected, wait for one
  434 00104 764000      rs2, cli
  435 00105 724722           iot rcs
  436 00106 760040           lai
  437 00107 020650           and (dsfopn
  438 00110 640100           sza
  439 00111 600114           jmp rs3
  440 00112 220651           lio (sbcset ctl
  441 00113 724222           iot scb
  442                   
  443 00114 764000      rs3, cli
  444 00115 724722           iot rcs
  445 00116 760040           lai
  446 00117 020652           and (dsfcon
  447 00120 650100           sza i
  448 00121 600114           jmp rs3
  449                   
  450                   / lock the send channel to 0 
  451 00122 764000           cli
  452 00123 724122           iot ssb
  453                        say hl1
      00124 700323
      00125 040653
      00126 171051

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION     Page 9


  454                        say hl1b
      00127 700337
      00130 040653
      00131 171051
  455                        say hl1c
      00132 700373
      00133 040653
      00134 171051
  456                   
  457                   / get the track to load or the command
  458                   / if not valid, ask again
  459                   / if a fatal error occurs, halt then rebind and go back to the connection wait
  460                   try, say hl2
      00135 700417
      00136 040653
      00137 171051
  461 00140 220654           lio (linbuf
  462 00141 171026           jda getaln
  463 00142 760040           lai
  464 00143 640100           sza
  465 00144 600317           jmp dcsfal
  466                        newline
      00145 700012
      00146 760020
      00147 724022
  467 00150 220654           lio (linbuf
  468 00151 171073           jda getnum
  469                   / AC has number, IO neg if no number, char in low bits
  470 00152 652000           spi i
  471 00153 600236           jmp getnld
  472 00154 760040           lai
  473 00155 020655           and (377
  474 00156 500656           sad (150
  475 00157 600166           jmp stp
  476 00160 500657           sad (154
  477 00161 600172           jmp list
  478                        say badnum
      00162 700477
      00163 040653
      00164 171051
  479 00165 600135           jmp try
  480 00166 220660      stp, lio (sbcrst
  481 00167 724222           iot scb
  482 00170 760400           hlt
  483 00171 600100           jmp resume
  484                   
  485                   / List programs on the drum
  486                   / Loop thru all tracks getting the control block, 7751-7777
  487                   list,
  488                        newline
      00172 700012
      00173 760020
      00174 724022
  489 00175 340235           dzm trk
  490 00176 200235      lst2, lac trk
  491 00177 665077           sal 6s
  492 00200 665077           sal 6s

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 10


  493 00201 040661           ior (drmrd isr
  494 00202 760020           lia
  495 00203 720061           iot dia
  496 00204 700026           law 26
  497 00205 760020           lia
  498 00206 720062           iot dwc
  499 00207 703000           law linbuf
  500 00210 040653           ior (bnk
  501 00211 760020           lia
  502 00212 720063           iot dcl
  503 00213 203025           lac linbuf+25
  504 00214 500662           sad (707070
  505 00215 600217           jmp .+2
  506 00216 600231           jmp trkn
  507 00217 170603           jda prttrk
  508                        say dir
      00220 700475
      00221 040653
      00222 171051
  509                        say linbuf
      00223 703000
      00224 040653
      00225 171051
  510                        newline
      00226 700012
      00227 760020
      00230 724022
  511 00231 440235      trkn, idx trk
  512 00232 500663           sad (040
  513 00233 600135           jmp try
  514 00234 600176           jmp lst2
  515 00235 000000      trk, 0
  516                   
  517                   / AC has the track to load
  518                   / load bank 0 mem from drum
  519                   getnld,
  520 00236 665077           sal 6s
  521 00237 665077           sal 6s
  522 00240 040644           ior (drmrd
  523 00241 760020           lia
  524 00242 720061           iot dia
  525 00243 764000           cli
  526 00244 720062           iot dwc
  527 00245 720063           iot dcl
  528                   
  529                   / bank 0 now has pgm loaded, check for valid load entry
  530 00246 707777           law 7777
  531 00247 240636           dac ads
  532 00250 210636           lac i ads
  533 00251 500662           sad (707070
  534 00252 600257           jmp trkok
  535                        say inval
      00253 700526
      00254 040653
      00255 171051
  536 00256 600135           jmp try
  537                   

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 11


  538                   / say the pgm, copy our bank 0 stuff again
  539                   trkok,
  540                        say bye
      00257 700562
      00260 040653
      00261 171051
  541                   / show the directory filename
  542 00262 707751           law isr
  543 00263 171051           jda txtasc
  544                        say bye2
      00264 700573
      00265 040653
      00266 171051
  545                   
  546                   / copy our low mem code
  547 00267 340637           dzm adt
  548 00270 200664           lac (b0a
  549 00271 040653           ior (bnk
  550 00272 240636           dac ads
  551 00273 700004           law 4
  552 00274 170620           jda cpy
  553                   
  554                   / copy our high mem code
  555 00275 707751           law isr
  556 00276 240637           dac adt
  557 00277 200665           lac (b0b
  558 00300 040653           ior (bnk
  559 00301 240636           dac ads
  560 00302 700020           law 20
  561 00303 170620           jda cpy
  562                   
  563                   / start 2 second countdown
  564 00304 703720           law 3720
  565 00305 732132           iot i cct
  566 00306 760200           cla
  567 00307 722132           iot cct
  568                   
  569                   / Close the channel, it will reopen on the next connection
  570 00310 220666           lio (sbcbnd
  571 00311 724222           iot scb
  572                   / be sure things are cleaned up interrupt-wise
  573 00312 720056           cbs
  574 00313 764000           cli
  575 00314 724522           iot rci
  576                   / and transfer back to bank 0, adr 7765
  577 00315 610316           jmp i b0s
  578 00316 007765      b0s, 7765
  579                   
  580                   / we had an error, just rebind and wait
  581 00317 220666      dcsfal, lio (sbcbnd
  582 00320 724222           iot scb
  583 00321 760400           hlt
  584 00322 600100           jmp resume
  585                   
  586                   hl1, / ascii
  587 00323 110145           110145
  588 00324 154154           154154

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 12


  589 00325 157040           157040
  590 00326 146162           146162
  591 00327 157155           157155
  592 00330 040171           040171
  593 00331 157165           157165
  594 00332 162040           162040
  595 00333 120151           120151
  596 00334 104120           104120
  597 00335 061041           061041
  598 00336 012000           012000
  599                   
  600                   hl1b, / ascii
  601 00337 117156           117156
  602 00340 143145           143145
  603 00341 040171           040171
  604 00342 157165           157165
  605 00343 040163           040163
  606 00344 145154           145154
  607 00345 145143           145143
  608 00346 164040           164040
  609 00347 141040           141040
  610 00350 160162           160162
  611 00351 157147           157147
  612 00352 162141           162141
  613 00353 155054           155054
  614 00354 040164           040164
  615 00355 150151           150151
  616 00356 163040           163040
  617 00357 143157           143157
  618 00360 156156           156156
  619 00361 145143           145143
  620 00362 164151           164151
  621 00363 157156           157156
  622 00364 040167           040167
  623 00365 151154           151154
  624 00366 154040           154040
  625 00367 143154           143154
  626 00370 157163           157163
  627 00371 145056           145056
  628 00372 012000           012000
  629                   
  630                   hl1c, / ascii
  631 00373 117160           117160
  632 00374 145156           145156
  633 00375 040151           040151
  634 00376 164040           164040
  635 00377 141147           141147
  636 00400 141151           141151
  637 00401 156040           156040
  638 00402 164157           164157
  639 00403 040163           040163
  640 00404 145154           145154
  641 00405 145143           145143
  642 00406 164040           164040
  643 00407 141040           141040
  644 00410 156145           156145
  645 00411 167040           167040

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 13


  646 00412 160162           160162
  647 00413 157147           157147
  648 00414 162141           162141
  649 00415 155056           155056
  650 00416 012000           012000
  651                   
  652                   hl2, / ascii
  653 00417 120162           120162
  654 00420 157147           157147
  655 00421 162141           162141
  656 00422 155040           155040
  657 00423 156165           156165
  658 00424 155142           155142
  659 00425 145162           145162
  660 00426 040164           040164
  661 00427 157040           157040
  662 00430 154157           154157
  663 00431 141144           141144
  664 00432 054040           054040
  665 00433 060055           060055
  666 00434 063061           063061
  667 00435 054040           054040
  668 00436 154040           154040
  669 00437 164157           164157
  670 00440 040154           040154
  671 00441 151163           151163
  672 00442 164040           164040
  673 00443 141166           141166
  674 00444 141151           141151
  675 00445 154141           154141
  676 00446 142154           142154
  677 00447 145054           145054
  678 00450 012157           012157
  679 00451 162040           162040
  680 00452 150040           150040
  681 00453 164157           164157
  682 00454 040143           040143
  683 00455 154157           154157
  684 00456 163145           163145
  685 00457 040141           040141
  686 00460 154154           154154
  687 00461 040143           040143
  688 00462 157156           157156
  689 00463 156145           156145
  690 00464 143164           143164
  691 00465 151157           151157
  692 00466 156163           156163
  693 00467 040141           040141
  694 00470 156144           156144
  695 00471 040150           040150
  696 00472 141154           141154
  697 00473 164077           164077
  698 00474 040000           040000
  699                   
  700                   
  701                   dir, / ascii
  702 00475 040055           040055

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 14


  703 00476 040000           040000
  704                   
  705                   
  706                   badnum, / ascii
  707 00477 123157           123157
  708 00500 162162           162162
  709 00501 171054           171054
  710 00502 040164           040164
  711 00503 150141           150141
  712 00504 164047           164047
  713 00505 163040           163040
  714 00506 156157           156157
  715 00507 164040           164040
  716 00510 141040           141040
  717 00511 166141           166141
  718 00512 154151           154151
  719 00513 144040           144040
  720 00514 156165           156165
  721 00515 155142           155142
  722 00516 145162           145162
  723 00517 054040           054040
  724 00520 164162           164162
  725 00521 171040           171040
  726 00522 141147           141147
  727 00523 141151           141151
  728 00524 156056           156056
  729 00525 012000           012000
  730                   
  731                   inval, / ascii
  732 00526 124150           124150
  733 00527 141164           141164
  734 00530 040164           040164
  735 00531 162141           162141
  736 00532 143153           143153
  737 00533 040144           040144
  738 00534 157145           157145
  739 00535 163040           163040
  740 00536 156157           156157
  741 00537 164040           164040
  742 00540 150141           150141
  743 00541 166145           166145
  744 00542 040141           040141
  745 00543 040160           040160
  746 00544 162157           162157
  747 00545 147162           147162
  748 00546 141155           141155
  749 00547 040154           040154
  750 00550 157141           157141
  751 00551 144145           144145
  752 00552 144054           144054
  753 00553 040164           040164
  754 00554 162171           162171
  755 00555 040141           040141
  756 00556 147141           147141
  757 00557 151156           151156
  758 00560 056012           056012
  759 00561 000000           000000

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 15


  760                   
  761                   
  762                   bye, / ascii
  763 00562 012114           012114
  764 00563 157141           157141
  765 00564 144151           144151
  766 00565 156147           156147
  767 00566 040160           040160
  768 00567 162157           162157
  769 00570 147162           147162
  770 00571 141155           141155
  771 00572 040000           040000
  772                   
  773                   bye2, / ascii
  774 00573 040164           040164
  775 00574 150145           150145
  776 00575 156040           156040
  777 00576 143154           143154
  778 00577 157163           157163
  779 00600 151156           151156
  780 00601 147056           147056
  781 00602 012000           012000
  782                   
  783                   
  784                   / Print the track number in location trk as 2 decimal digits.
  785 00603 000000      prttrk, 0
  786 00604 260617          dap prtrtn
  787 00605 760200          cla
  788 00606 220235          lio trk
  789 00607 666001          sil 1s
  790 00610 560647          div (12
  791 00611 400646          add (60
  792 00612 760060          lsw
  793 00613 724022          iot tcb
  794 00614 400646          add (60
  795 00615 760020          lia
  796 00616 724022          iot tcb
  797 00617 600617      prtrtn, jmp .
  798                   
  799                   / Copy from one mem bank to another.
  800                   / AC has the count of words to copy.
  801                   / Location ads has the location in the source bank to copy from.
  802                   / Location adt has the destination.
  803                   / Both can have extended addresses.
  804                   / If extended addresses are used, be sure an eem has been done first.
  805 00620 000000      cpy, 0
  806 00621 260635          dap cpydn
  807 00622 200620          lac cpy
  808 00623 761000          cma
  809 00624 400650      cl, add (1
  810 00625 760060          lsw
  811 00626 210636          lac i ads
  812 00627 250637          dac i adt
  813 00630 440636          idx ads
  814 00631 440637          idx adt
  815 00632 760060          lsw
  816 00633 640100          sza

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 16


  817 00634 600624          jmp cl
  818 00635 600635      cpydn, jmp .
  819 00636 000000      ads, 0
  820 00637 000000      adt, 0
  821                   
  822                   / server port, ascii, echo, and crlf on channel 0, interrupt on connect or disconnect
  823                   / listen on port 2022
  824 00640 564100      ctl, dcfcrnl dcfecho dcfsrv dcfie dcfioe dcfioc
  825 00641 003746           3746
  826                        octal
  827                   
  828                   // get our contants output so they don't step on us later
  829 00642 000140      constants
      00643 000020
      00644 400000
      00645 000015
      00646 000060
      00647 000012
      00650 000001
      00651 010640
      00652 000004
      00653 010000
      00654 003000
      00655 000377
      00656 000150
      00657 000154
      00660 040000
      00661 407751
      00662 707070
      00663 000040
      00664 000715
      00665 000721
      00666 020000
  830                   
  831                   / The channel 0 interrupt setup.
  832                   / We execute a bit of code that will get
  833                   / overwritten but reloaded on pgm switch.
  834 00715 720074      b0a, lem
  835 00716 607765           jmp strt
  836 00717 000000           0
  837 00720 607751           jmp isr
  838                   
  839                   / The bank 0 control transfer back to bank 1
  840                   / resides in the usual loader area starting at 7751.
  841                   b0b,
  842                   / A connect request comes here, isr, 7751.
  843                   / We have to jump thru hoops jumping to rti
  844                   / because you can't enable extended mem while in
  845                   / the interrupt and have it stick
  846 00721 707754           law 7754
  847 00722 240001           dac 1
  848 00723 610001           jmp i 1
  849                   
  850                   / The above ends up here, rtn, 7754. The jmp i 1 dismissed the interrupt.
  851                   / Enable extened memory and  jump back to our control code.
  852                   / We have to construct the address because we can't use a stored constant.
  853 00724 700100           law resume

      SELECT AND RUN A DRUMLOADER PROGRAM VIA REMOTE CONNECTION ASCII VERSION    Page 17


  854 00725 673077           rcr 6s
  855 00726 673077           rcr 6s
  856 00727 700001           law bnkno
  857 00730 663077           rcl 6s
  858 00731 663077           rcl 6s
  859 00732 240000           dac 0
  860 00733 724074           eem
  861 00734 610000           jmp i 0
  862                   
  863                   / The controller jumps here, strt, 7765, to start the program.
  864                   / Be sure to not overwrite 7773-7777!
  865 00735 720074          lem
  866 00736 720055          esm
  867 00737 617773          jmp i sadr
  868                   
  869                   constants
  870                   
  871                   / We are started here in bank 0, copy our control program imagefrom this bank to the same
  872                   / locations in the bank  used for the control program and jump to 100 there.
  873                   / Why all this hand-waving? Neither macro nor the default loader handles extended memory. Lame  874 00740 000740      .
  875 06000             6000/
  876 06000 724074          eem
  877 06001 700100          law 100
  878 06002 240636          dac ads
  879 06003 046013          ior lclbnk
  880 06004 240637          dac adt
  881                   / AC has the number of words to copy
  882 06005 702000          law 2000
  883 06006 170620          jda cpy
  884                   
  885 06007 700100          law 100
  886 06010 046013          ior lclbnk
  887 06011 240636          dac ads
  888 06012 610636          jmp i ads
  889 06013 010000      lclbnk, bnk
  890                   
  891       006000      start 6000

      No errors detected
